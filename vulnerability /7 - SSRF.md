## SSRF

برای پیدا کردن آسیب‌پذیری SSRF (Server-Side Request Forgery) در تست نفوذ وب، باید نقاطی از برنامه که ورودی URL یا آدرس دریافت می‌کنند و سرور بر اساس آن درخواست‌هایی به منابع داخلی یا خارجی ارسال می‌کند را شناسایی و تست کنید. روش‌ها و مراحل اصلی به شرح زیر است:

1. شناسایی نقاط آسیب‌پذیر بالقوه
بخش‌هایی از برنامه که ورودی URL می‌گیرند (مثلاً APIهایی که URL دریافت می‌کنند، سیستم‌های دانلود فایل، وب‌هوک‌ها، یا هر جایی که سرور درخواست HTTP ارسال می‌کند)

پارامترهای ورودی که به سرور داده می‌شوند و ممکن است به درخواست‌های سمت سرور تبدیل شوند

2. تست دستی با ارسال URLهای مخرب
به جای URL معتبر، آدرس‌هایی که به منابع داخلی اشاره دارند (مثل http://localhost, http://127.0.0.1, http://169.254.169.254 برای سرویس‌های ابری، یا IPهای خصوصی مانند 10.*.*.*، 192.168.*.*) را ارسال کنید.

نمونه درخواست JSON یا POST:
```bash
json
{
  "url": "http://localhost/admin"
}
```
اگر سرور این درخواست را بدون اعتبارسنجی قبول کند و محتوای صفحه داخلی را برگرداند، آسیب‌پذیری SSRF وجود دارد.

3. تست دور زدن فیلترها
استفاده از روش‌های مختلف برای دور زدن فیلترها، مثل:

جایگزینی localhost با IP معادل (مثلاً 127.0.0.1)

استفاده از قالب‌های مختلف URL (مثلاً http://127.0.0.1:80, http://[::1])

رمزگذاری URL یا استفاده از آدرس‌های غیرمعمول (مثلاً http://2130706433 که معادل 127.0.0.1 است)

استفاده از پروتکل‌های متفاوت (file://، gopher://)

4. بررسی پاسخ‌ها و استخراج اطلاعات
مشاهده پاسخ سرور: آیا محتوای داخلی یا اطلاعات حساس برگردانده می‌شود؟

اگر پاسخ مستقیم نیست (Blind SSRF)، می‌توانید از روش‌های جانبی مثل ارسال درخواست به سرور کنترل شده توسط خودتان و بررسی لاگ‌ها استفاده کنید.

بررسی لاگ‌های سرور برای درخواست‌های ارسالی به URLهای مخرب.

5. استفاده از ابزارهای خودکار و اسکنرها
ابزارهایی مانند Burp Suite (Intruder و Repeater)، Nmap با اسکریپت‌های NSE، SSRFmap و اسکنرهای تخصصی SSRF می‌توانند در کشف آسیب‌پذیری کمک کنند.

همچنین می‌توانید از اسکریپت‌ها و فریم‌ورک‌های متن‌باز برای تست SSRF بهره ببرید.

6. نکات مهم
SSRF می‌تواند منجر به افشای اطلاعات داخلی، اسکن شبکه‌های داخلی، اجرای کد از راه دور و حتی دسترسی به سرویس‌های ابری شود.

بررسی کنید که آیا سرور پاسخ درخواست‌های داخلی را به کلاینت برمی‌گرداند یا خیر (SSRF معمولی یا کور).

حتماً تست‌های دور زدن فیلترها را انجام دهید، چون اغلب برنامه‌ها فیلترهای ساده دارند.

بررسی کنید که آیا درخواست‌های سمت سرور محدود به دامنه‌های خاص یا IPهای مشخص شده است یا خیر.

منابع برای مطالعه و آموزش بیشتر
مقاله آموزش SSRF و نحوه شناسایی آن در سایت «آم‌نرم‌افزار رایکا»

آموزش و مثال‌های عملی SSRF در PortSwigger

مقاله و آموزش‌های تخصصی SSRF در سایت‌های امنیتی ایرانی و بین‌المللی

خلاصه
برای پیدا کردن SSRF:

نقاطی که URL یا آدرس دریافت می‌کنند را شناسایی کنید.

آدرس‌های داخلی و مخرب را به جای ورودی معتبر ارسال کنید.

پاسخ سرور را بررسی کنید که آیا به منابع داخلی دسترسی داده شده یا خیر.

از روش‌های دور زدن فیلتر برای افزایش شانس موفقیت استفاده کنید.

در صورت کور بودن SSRF، از روش‌های جانبی مثل سرورهای کنترل‌شده برای اثبات آسیب‌پذیری بهره ببرید.

این روش‌ها به شما کمک می‌کند آسیب‌پذیری SSRF را در تست نفوذ وب به صورت جامع و دقیق شناسایی کنید.
