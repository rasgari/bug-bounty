## Subdomain_takeover

آسیب‌پذیری Subdomain Takeover زمانی رخ می‌دهد که یک زیر دامنه (Subdomain) به یک سرویس خارجی (مانند GitHub Pages، AWS S3، Heroku و غیره) اشاره کند اما آن سرویس دیگر فعال نباشد یا حذف شده باشد؛ در این حالت مهاجم می‌تواند با ثبت سرویس مشابه، کنترل آن زیر دامنه را به دست بگیرد و محتوای مخرب یا جعلی ارائه دهد.

چگونه آسیب‌پذیری Subdomain Takeover را در تست نفوذ وب پیدا کنیم؟
1. شناسایی زیر دامنه‌ها و رکوردهای DNS
با ابزارهایی مانند subfinder، Amass یا dnsrecon، زیردامنه‌های دامنه هدف را جمع‌آوری کنید.

رکوردهای DNS مرتبط با این زیردامنه‌ها (خصوصاً CNAME و A) را با دستوراتی مانند dig یا ابزارهای DNS enumeration بررسی کنید.

2. شناسایی رکوردهای معیوب یا اشاره به سرویس‌های غیرفعال
رکوردهایی که به سرویس‌هایی اشاره دارند که دیگر فعال نیستند (مثلاً پاسخ NXDOMAIN یا خطاهای DNS مانند SERVFAIL).

رکوردهای CNAME که به سرویس‌های ابری معروف اشاره دارند ولی سرویس مربوطه حذف شده است.

3. تست دستی تصاحب زیر دامنه
اگر رکورد CNAME به GitHub Pages اشاره دارد اما صفحه 404 می‌دهد، می‌توانید با ایجاد یک حساب GitHub و ساخت صفحه‌ای با همان نام، زیر دامنه را تصاحب کنید.

مشابه این کار را برای سرویس‌های AWS S3، Heroku، Azure Blob Storage و غیره انجام دهید.

4. استفاده از ابزارهای خودکار
ابزارهایی مانند Subjack, Takeover, Subzy و ابزار معرفی شده در آکادمی اولترا آموز می‌توانند به صورت اتوماتیک زیر دامنه‌های آسیب‌پذیر را شناسایی کنند.

این ابزارها با بررسی رکوردهای DNS و پاسخ‌های HTTP، احتمال آسیب‌پذیری را گزارش می‌دهند و خطاهای کمتری (False Positive) دارند.

5. بررسی رکوردهای NS و MX
آسیب‌پذیری تصاحب زیر دامنه ممکن است در رکوردهای NS (Nameserver) و MX (Mail Exchange) نیز رخ دهد که خطرناک‌تر است.

بررسی کنید آیا رکوردهای NS یا MX به دامنه‌های منقضی شده یا غیرفعال اشاره دارند.

6. نکات مهم در تست و پیشگیری
همیشه رکوردهای DNS را پس از حذف سرویس‌های خارجی به‌روزرسانی کنید.

زیر دامنه‌های بلااستفاده را حذف کنید یا رکوردهای DNS آن‌ها را پاک کنید.

استفاده از ابزارهای مانیتورینگ برای شناسایی سریع رکوردهای آسیب‌پذیر.

خلاصه مراحل تست Subdomain Takeover
مرحله	ابزار / روش پیشنهادی	توضیح
جمع‌آوری زیردامنه‌ها	subfinder, Amass, dnsrecon	استخراج زیردامنه‌های هدف
بررسی رکوردهای DNS	dig, host, nslookup, ابزارهای DNS enumeration	شناسایی رکوردهای CNAME، A، NS و MX
شناسایی رکوردهای معیوب	بررسی پاسخ NXDOMAIN، SERVFAIL، 404	رکوردهایی که به سرویس غیرفعال اشاره دارند
تست تصاحب دستی	ساخت حساب در سرویس‌های هدف (GitHub, AWS, Heroku)	ثبت سرویس مشابه برای تصاحب زیر دامنه
استفاده از ابزار خودکار	Subjack, Takeover, Subzy, Subzap	اسکن سریع و دقیق با کمترین خطا
بررسی رکوردهای NS و MX	dig + بررسی دامنه‌های منقضی شده	آسیب‌پذیری‌های خطرناک‌تر
منابع فارسی و ابزارهای مفید
ابزار شناسایی Subdomain Takeover - آکادمی اولترا آموز

حمله Subdomain Takeover چیست و چه آسیبی می‌رساند؟ - امن افزار رایکا

WSTG-CONFIG-010 بررسی Subdomain Takeover - securityworld.ir

آموزش و معرفی ابزار Subjack و روش‌های تست

ابزار Osmedeus برای اسکن و شناسایی Subdomain Takeover

نمونه دستور برای بررسی رکورد CNAME آسیب‌پذیر با dig
```bash
dig CNAME subdomain.example.com +short
```
اگر پاسخ خالی یا خطا بود (مثلاً NXDOMAIN)، احتمال آسیب‌پذیری وجود دارد.

نکته نهایی
Subdomain Takeover یکی از آسیب‌پذیری‌های مهم و رایج در تست نفوذ وب است که می‌تواند منجر به تصاحب زیر دامنه‌های سازمان شده و حملات گسترده‌ای مثل فیشینگ، سرقت داده و بدافزار شود.
با استفاده از روش‌ها و ابزارهای فوق، می‌توانید این آسیب‌پذیری را به صورت دقیق و سریع شناسایی کنید و گزارش دهید.
